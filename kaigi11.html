<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Keranjang — TokoAraa</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style> body{ background:#f6fbff } .product-thumb{ width:90px; height:70px; object-fit:cover; border-radius:8px; } </style>
</head>
<body>
<nav class="navbar navbar-expand-lg" style="background:linear-gradient(90deg,#a9e1ff,#6fcfff)">
  <div class="container">
    <a class="navbar-brand" href="kaigi88.html">TokoAraa</a>
    <div class="ms-auto">
      <a href="kaigi81.html" class="btn btn-sm btn-light">Tentang</a>
    </div>
  </div>
</nav>

<div class="container my-4">
  <h4>Keranjang Anda</h4>

  <div id="cartArea" class="mt-3"></div>

  <hr>

  <h5>Tinggalkan Komentar untuk Pesanan</h5>
  <div class="mb-3">
    <textarea id="orderComment" class="form-control" rows="3" placeholder="Masukkan catatan pengiriman atau komentar untuk penjual..."></textarea>
    <button id="saveComment" class="btn btn-primary mt-2">Simpan Komentar</button>
  </div>

  <hr>
  <h5>Testimoni Pembeli</h5>
  <div id="testimonyList"></div>

  <h6 class="mt-3">Tulis Testimoni</h6>
  <div class="mb-3">
    <input id="tName" class="form-control mb-2" placeholder="Nama Anda (opsional)">
    <textarea id="tMessage" class="form-control mb-2" rows="2" placeholder="Pesan/testimoni..."></textarea>
    <button id="submitTesti" class="btn btn-outline-primary">Kirim Testimoni</button>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
  function formatRp(n){ return 'Rp ' + n.toString().replace(/\B(?=(\d{3})+(?!\d))/g, "."); }
  function loadCart(){
    const cart = JSON.parse(localStorage.getItem('tokoaraa_cart')||'[]');
    const area = document.getElementById('cartArea');
    if(cart.length===0){ area.innerHTML = '<div class="alert alert-info">Troli kosong. <a href="index.html">Belanja sekarang</a></div>'; return;}
    let html = '<div class="list-group">';
    let total = 0;
    cart.forEach((it, idx)=>{
      total += it.price * it.qty;
      html += `
        <div class="list-group-item d-flex align-items-center gap-3">
          <img src="${it.img}" class="product-thumb">
          <div class="flex-grow-1">
            <div class="d-flex justify-content-between">
              <div><strong>${it.name}</strong><div class="small text-muted">${formatRp(it.price)} x ${it.qty}</div></div>
              <div class="text-end">
                <div><strong>${formatRp(it.price * it.qty)}</strong></div>
                <div class="mt-2">
                  <button class="btn btn-sm btn-outline-secondary dec" data-idx="${idx}">-</button>
                  <button class="btn btn-sm btn-outline-secondary inc" data-idx="${idx}">+</button>
                  <button class="btn btn-sm btn-danger del" data-idx="${idx}">Hapus</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      `;
    });
    html += '</div>';
    html += `<div class="mt-3 p-3 bg-white rounded shadow-sm"><div class="d-flex justify-content-between"><div>Total</div><div class="fw-bold">${formatRp(total)}</div></div><div class="mt-3"><button id="checkout" class="btn btn-primary">Checkout</button></div></div>`;
    area.innerHTML = html;

    document.querySelectorAll('.inc').forEach(b=> b.addEventListener('click', e=>{
      const i = Number(e.currentTarget.dataset.idx);
      const c = JSON.parse(localStorage.getItem('tokoaraa_cart')||'[]');
      c[i].qty++;
      localStorage.setItem('tokoaraa_cart', JSON.stringify(c));
      loadCart();
    }));
    document.querySelectorAll('.dec').forEach(b=> b.addEventListener('click', e=>{
      const i = Number(e.currentTarget.dataset.idx);
      const c = JSON.parse(localStorage.getItem('tokoaraa_cart')||'[]');
      if(c[i].qty>1) c[i].qty--; else c.splice(i,1);
      localStorage.setItem('tokoaraa_cart', JSON.stringify(c));
      loadCart();
    }));
    document.querySelectorAll('.del').forEach(b=> b.addEventListener('click', e=>{
      const i = Number(e.currentTarget.dataset.idx);
      const c = JSON.parse(localStorage.getItem('tokoaraa_cart')||'[]');
      c.splice(i,1);
      localStorage.setItem('tokoaraa_cart', JSON.stringify(c));
      loadCart();
    }));
  }

  // Comment for order
  document.getElementById('saveComment').addEventListener('click', ()=>{
    const txt = document.getElementById('orderComment').value.trim();
    localStorage.setItem('tokoaraa_order_comment', txt);
    alert('Komentar pesanan disimpan ✅');
  });

  // Testimonials
  function loadTesti(){
    const list = JSON.parse(localStorage.getItem('tokoaraa_testi')||'[]');
    const wrap = document.getElementById('testimonyList');
    if(list.length===0) wrap.innerHTML = '<div class="text-muted">Belum ada testimoni, jadilah yang pertama!</div>';
    else {
      let html = '<div class="row g-3">';
      list.slice().reverse().forEach(t=>{
        html += `<div class="col-12 col-md-6">
          <div class="p-3 bg-white rounded shadow-sm">
            <strong>${t.name || 'Pembeli'}</strong>
            <p class="mb-0">${t.msg}</p>
            <div class="small text-muted mt-2">${new Date(t.time).toLocaleString()}</div>
          </div>
        </div>`;
      });
      html += '</div>';
      wrap.innerHTML = html;
    }
  }
  document.getElementById('submitTesti').addEventListener('click', ()=>{
    const name = document.getElementById('tName').value.trim();
    const msg = document.getElementById('tMessage').value.trim();
    if(!msg){ alert('Tulis pesan testimoni dulu.'); return; }
    const all = JSON.parse(localStorage.getItem('tokoaraa_testi')||'[]');
    all.push({name, msg, time: Date.now()});
    localStorage.setItem('tokoaraa_testi', JSON.stringify(all));
    document.getElementById('tName').value=''; document.getElementById('tMessage').value='';
    loadTesti();
    alert('Terima kasih, testimoni terkirim!');
  });

  // Checkout (demo)
  document.addEventListener('click', e=>{
    if(e.target && e.target.id==='checkout'){
      alert('Fitur checkout belum terhubung ke pembayaran. Ini demo lokal.');
    }
  });

  // Init
  loadCart();
  loadTesti();
</script>
</body>
</html>
